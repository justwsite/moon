<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8">
<link rel="icon" href="icon.webp">
<title>Фазы Луны в Фаэруне</title><style>
* {background: #111827; padding: 10px; border-radius: 10px; font-family: sans-serif;}
body, html {font-size: 25px; color: #ffffff;}
span, select, option, button, input {background: #1f2937; color: inherit; font-size: inherit;}
input {border: 0; background: 0; width: 4ch;}
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
-webkit-appearance: none;margin: 0;}
input[type=number]:focus {outline: none; box-shadow: none;}
div {white-space: pre;}
</style></head><body>

Введите Год &emsp;<span><input type="number" min="0" id="numInput"> DR</span><br><br>

День в Forgotten Realms &emsp;<button onclick="prevOption(1)">&#10216</button>
<select id="select1"></select>
<button onclick="nextOption(1)">&#10217</button><br><br>

День в Real Life &emsp;<button onclick="prevOption(2)">&#10216</button>
<select id="select2"></select>
<button onclick="nextOption(2)">&#10217</button>

<div id="info"></div>
<script>
  const btn = document.querySelectorAll("button")
  const input = document.getElementById('numInput');
  const selectfr = document.getElementById('select1');
  const selectrl = document.getElementById('select2');
  const div = document.getElementById('info');
  function prevOption(id) {
      id1 = 'select' + id;
      id2 = 'select' + (3-id);
      var s1 = document.getElementById(id1);
      var s2 = document.getElementById(id2);
      var i = s1.selectedIndex;
      if (i > 0) {i = i-1;}
      s1.selectedIndex = i;
      s2.selectedIndex = i;
      moon();}
    function nextOption(id) {
      id1 = 'select' + id;
      id2 = 'select' + (3-id);
      var s1 = document.getElementById(id1);
      var s2 = document.getElementById(id2);
      var i = s1.selectedIndex;
      var l = s1.options.length-1;
      if (i < l) {i = i+1;}
      s1.selectedIndex = i;
      s2.selectedIndex = i;
      moon();}
  function fill(array, arr, select, index) {
    if(!input.value) {
      select.innerHTML = "<option value='0'>&emsp;&emsp;&emsp;&emsp;&emsp;</option>";
      return;
    }
    select.innerHTML = '';
    for (let i=0; i<array.length; i++) {
      let w = array[i][0];
      let v = arr[i][0];
      let q = array[i][1];
      for (let k=1; k<=q; k++) {
        var option = document.createElement('option');
        d = k;
        if(q==1) {d = "\xA0\xA0";}
        p = "\xA0\xA0\xA0";
        if (k<10) {p = "\xA0\xA0\xA0\xA0\xA0";}
        option.value = d + " " + v;
        option.textContent = d + p + w;
        console.log(option.textContent);
        select.appendChild(option);}}
    select.selectedIndex = index;}
  selectfr.addEventListener('change', () => {
    const Index = selectfr.selectedIndex;
    selectrl.selectedIndex = Index;
    moon();});
  selectrl.addEventListener('change', () => {
    const Index = selectrl.selectedIndex;
    selectfr.selectedIndex = Index;
    moon();});

  function phase(midnight, fullcycle) {
    let p = 2*Math.PI*midnight/fullcycle;
    let z = parseInt((1+Math.cos(p))*50);
    return " ≈ " + z + "%";}
  function moon() {
    var lq = 10957.5; // last quarter
    var nm = 21915; // new moon
    var fq = 32872.5; // first quarter
    var fm = 43830; // full moon

    var d = selectfr.selectedIndex+1;
    if(!input.value) {
      div.textContent = "Введите год по летоисчислению Долин.";
      return;
    }
    var y = parseInt(input.value)%4;
    let dd = 0;
    if (y==0 && d>=214) {dd = 1}
    var d = (d+dd+365*y)*1440;
    var half = 720;
    var start = d-half;
    var end = d+half;
    var fullcycle = 43830;
    let m = 0;
    while(m+fullcycle < start) {m = m+fullcycle;}
    start = start-m;
    end = end-m;
    var txt = "";
    if(start==half || end==half || (start <= fm && fm <= end)) {txt = "Полнолуние 100%"}
    else if(start <= lq && lq <= end) {txt = "Последняя Четверть 50%"}
    else if(start <= nm && nm <= end) {txt = "Новолуние 0%"}
    else if(start <= fq && fq<= end) {txt = "Первая Четверть 50%"}
    else {var midnight = start+half;
      if(midnight>0 && midnight<lq) {txt = "Убывающая Луна"}
      else if(midnight>lq && midnight<nm) {txt = "Убывающий Месяц"}
      else if(midnight>nm && midnight<fq) {txt = "Растущий Месяц"}
      else if(midnight>fq && midnight<fm) {txt = "Растущая Луна"}
      txt = txt + phase(midnight, fullcycle);}
  let a = selectfr.selectedIndex;
  let b = selectfr.selectedIndex+1;
  let av = selectfr.options[a]?.value;
  let bv = selectfr.options[b]?.value;
  div.textContent = "В ночь с " + av + " по " + bv + '\n' + txt;}

  input.addEventListener('input', () => {
    if (input.value) {btn.forEach(b => b.style.display = "inline-block");} 
    else {btn.forEach(b => b.style.display = "none");}
    var y = parseInt(input.value);
    var FR0 = [["Хаммер (Разгар Зимы)", 30], 
              ["Макушка зимы (Праздник)", 1], 
              ["Альтуриак (Месяц Зимы)", 30], 
              ["Чес (Месяц Закатов)", 30], 
              ["Тарсах (Месяц Гроз)", 30], 
              ["День Зеленой травы (Праздник)", 1], 
              ["Миртул (Месяц Таяния)", 30], 
              ["Киторн (Время Цветов)", 30], 
              ["Флеймрул (Месяц Летнего Прилива)", 30], 
              ["Солнцеворот (Праздник)", 1], 
              ["Щитовый сход (Праздник)", 0], 
              ["Элесиас (Месяц Высокого Солнца)", 30], 
              ["Элейнт (Месяц Увядания)", 30], 
              ["Праздник урожая (Праздник)", 1], 
              ["Марпенот (Месяц Листопадов)", 30], 
              ["Уктар (Месяц Гниения)", 30], 
              ["Пир Луны (Праздник)", 1], 
              ["Найтол (Закат Года)", 30]];
    var FR = [["Хаммер", 30], 
              ["Макушка зимы", 1], 
              ["Алтуриак", 30], 
              ["Чес", 30], 
              ["Тарсак", 30], 
              ["Зеленотравье", 1], 
              ["Миртул", 30], 
              ["Киторн", 30], 
              ["Флеймрул", 30], 
              ["Солнцеворот", 1], 
              ["Щитовый сход", 0], 
              ["Элесиас", 30], 
              ["Элейнт", 30], 
              ["Праздник урожая", 1], 
              ["Марпенот", 30], 
              ["Укта", 30], 
              ["Пир Луны", 1], 
              ["Найтол", 30]];
    var RL = [["Января", 31], 
              ["Февраля", 28], 
              ["Марта", 31], 
              ["Апреля", 30], 
              ["Мая", 31], 
              ["Июня", 30], 
              ["Июля", 31], 
              ["Августа", 31], 
              ["Сентября", 30], 
              ["Октября", 31], 
              ["Ноября", 30], 
              ["Декабря", 31]];
    if (y%4==0) {
      FR[10][1] = 1;
      RL[1][1] = 29;
    }
    var index = selectfr.selectedIndex || 0;
    fill(FR, FR0, selectfr, index);
    index = selectrl.selectedIndex || 0;
    fill(RL, RL, selectrl, index);
    moon();});
  input.dispatchEvent(new Event('input'));
</script></body></html>
